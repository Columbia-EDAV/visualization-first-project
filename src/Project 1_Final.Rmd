---
title: "Project 1: The Class"
output: html_document
---

```{r warning=FALSE, echo=FALSE, results='hide', message=FALSE}
# Data cleaning
# Load libraries
library(xlsx)
library(reshape)
library(stringr)
library(ggplot2)
library(cowplot)
library(devtools)
library(Rcpp)
library(httr)
library(rCharts)
library(rjson)
library(vcd)
library(ellipse)

# Read xlsx file
raw.data <- read.xlsx("../data/Survey_Response.xlsx", sheetName = "Form Responses 1")
data <- raw.data

# Drop empty columns
data <- data[, colSums(is.na(data)) < nrow(data)]


# Clean up variable names
cleaned.names <- c('waitlist', 'program','tools','exp.R.manipulation',
          'gender','text.editor','exp.R.graphics','exp.R.advanced','exp.R.reproducible','exp.Matlab','exp.Github')
names(data) <- cleaned.names

# Split tools column into multiple columns
## Count the maximum number of commas per row in the tools column
num.commas <- max(sapply(gregexpr(",", data$tools, fixed = TRUE), function(x) max(length(x)))) + 1
## Split the tools column in separate columns
tool.cols <- colsplit(data$tools,"[,]",names=sapply(1:num.commas, function(x) paste('tools', x, sep='')))
tool.cols <- sapply(tool.cols, str_trim)
unique.tool.values <- unique(unlist(lapply(tool.cols, FUN=unique)))
tool.matrix <- matrix(0, nrow = nrow(tool.cols),20)
tool.names <- unique.tool.values
colnames(tool.matrix) <- tool.names
tool.matrix <- as.data.frame(tool.matrix)
for (i in 1:ncol(tool.cols) ) {
      for (tool.name in tool.names) {
          tool.matrix[which(tool.cols[, i] == tool.name), tool.name] <- 1
          }
}
## Add cleaner tool names
clean.tool.names <- c("R", "Excel", "Matlab", "RStudio", "Github", "SQL", "Shell", "Python", "SPSS", "ggplot2", "GDrive", "Web", "C", "Dropbox", "Regex", "Stata", "LaTeX", "Sweave", "XML", "Lattice")
names(tool.matrix) <- clean.tool.names
data <- cbind(data, tool.matrix)
data <- subset(data, select=-c(tools))

# Clean up inconsistent program values
levels(data$program)
sort(table(data$program))
levels(data$program)[levels(data$program)=="Ms in ds"] <- "IDSE (master)"
levels(data$program)[levels(data$program)=="MSDS"] <- "IDSE (master)"
levels(data$program)[levels(data$program)=="PhD Biomedical Informatics"] <- "Ph.D."
levels(data$program)[levels(data$program)=="Data Science"] <- "Unknown"

# Clean up text editor values
levels(data$text.editor)
sort(table(data$text.editor))
# Remove extra spaces
data$text.editor <- factor(str_trim(data$text.editor))
# TextWrangler
levels(data$text.editor)[levels(data$text.editor)=="textwrangler"] <- "TextWrangler"
levels(data$text.editor)[levels(data$text.editor)=="Text Wrangler"] <- "TextWrangler"
levels(data$text.editor)[levels(data$text.editor)=="textWrangler"] <- "TextWrangler"
# Sublime Text
levels(data$text.editor)[levels(data$text.editor)=="Sublime"] <- "Sublime Text"
levels(data$text.editor)[levels(data$text.editor)=="Sublime Text 2"] <- "Sublime Text"
levels(data$text.editor)[levels(data$text.editor)=="sublime"] <- "Sublime Text"
levels(data$text.editor)[levels(data$text.editor)=="Sublime Text!"] <- "Sublime Text"
levels(data$text.editor)[levels(data$text.editor)=="sublime text 2"] <- "Sublime Text"
levels(data$text.editor)[levels(data$text.editor)=="Sublime 2"] <- "Sublime Text"
levels(data$text.editor)[levels(data$text.editor)=="sublime text"] <- "Sublime Text"
# Jupyter
levels(data$text.editor)[levels(data$text.editor)=="I used jupyter last semester"] <- "Jupyter"
## Ipython is now known as Jupyter
levels(data$text.editor)[levels(data$text.editor)=="Ipython"] <- "Jupyter"
# None
levels(data$text.editor)[levels(data$text.editor)=="haven't used any"] <- "None"

# Assign level ordering to experience variables
experience.cols <- names(data)[grepl("^exp.", names(data))]
for (exp.col in experience.cols) {
  data[, exp.col] <- factor(data[, exp.col], levels=levels(data[, exp.col])[c(4, 1, 2, 3)], ordered=TRUE)
}
```


# Background
The following analysis examines the 114 survey responses.


```{r echo=FALSE}
ggplot(data, aes(waitlist)) + 
  geom_bar() +
  coord_flip() +
  ggtitle('test') +
  ylab('Waitlisted') 
```



Analysis of Gender:

```{r echo=FALSE}

qplot(data$gender)
```

The code above generage a graph to demonstrate the ratio of male and female students. It is obvious to see that the number of male students are more than twice of the females in this class.Next is a more sophiscated plot and analysis on gender and the experience with R manipulation, advanced R, Matlab and Github.

```{r echo=FALSE}
# Exclude small sample sizes
data.1 <- data[c(-8,-98),]
g7 <- ggplot( data.1, aes(exp.R.manipulation, fill= gender)) +
  geom_density(alpha=0.5, lwd=0.8, adjust=0.5) + 
  theme(text = element_text(size=10),
        axis.text.x = element_text(size=7))

g8 <- ggplot( data.1, aes(exp.R.advanced, fill= gender)) +
  geom_density(alpha=0.5, lwd=0.8, adjust=0.5) +
  theme(text=element_text(size=10),
        axis.text.x= element_text(size=7))
g9 <- ggplot( data.1, aes(exp.Matlab, fill= gender)) +
  geom_density(alpha=0.5, lwd=0.8, adjust=0.5) +
  theme(text=element_text(size=10),
        axis.text.x= element_text(size=7))
g10 <- ggplot( data.1, aes(exp.Github, fill= gender)) +
  geom_density(alpha=0.5, lwd=0.8, adjust=0.5) +
  theme(text=element_text(size=10), axis.text.x= element_text(size=7))


plot_grid(g7,g8,g9,g10,labels=c("Manipulation","Advanced R","Matlab","Github"),label_size=10)
```

This density plot shows the distribution of skills in the four areas highlighted. As the size of the two groups(men-women) isn't equal in the class it is necessary to normalize the data as per frequency. 

Even with frequency accounted for we observed unequal skill distribution.

1. When it comes to basic R manipulation there is a higher percentage of men who have little  to none experience with R, while there are no women who are "experts"

2. The distribution for advanced R, Matlab and Github has a slightly higher percentage of men in all categories. 

Analysis on Programs
```{r echo=FALSE}
comp.R.exp <- data[,2:10]

g1 <- ggplot( comp.R.exp, aes(exp.R.manipulation, fill= program))+geom_bar()+theme(legend.position= "none",text=element_text(size=10),axis.text.x= element_text(size=10))

g2 <- ggplot( comp.R.exp, aes(exp.R.graphics, fill= program))+geom_bar()+theme(legend.position= "none",text=element_text(size=10),axis.text.x= element_text(size=10))

g3 <- ggplot( comp.R.exp, aes(exp.R.advanced, fill= program))+geom_bar()+theme(legend.position= "none",text= element_text(size=10),axis.text.x= element_text(size=10))

g4 <- ggplot( comp.R.exp, aes(exp.R.reproducible, fill= program))+geom_bar()+theme(legend.position= "none",text=element_text(size=10),axis.text.x= element_text(size=10))

g5 <- ggplot( comp.R.exp, aes(exp.Matlab, fill= program))+geom_bar()+theme(legend.position= "none",text=element_text(size=10),axis.text.x= element_text(size=10))

g6 <- ggplot( comp.R.exp, aes(exp.Github, fill= program))+geom_bar()+theme(text=element_text(size=10),axis.text.x= element_text(size=10))


plot_grid(g1,g2,g3,g4,g5,g6,labels=c("Manipulation","Graphics","Advanced R","Markdown","Matlab","Github"),label_size=8,vjust=1, ncol=2,nrow=3)
```

The figure above helps us understand the experience distribution program-wise, categorized by 4 ordered levels (None < A little < Confident < Expert) . A few inferences that can be drawn from  the graph are as follows :

1. A majority of class is confident in data manipulation in R with very few individuals in the none category and expert category. But its noteworthy that data manipulation in "Expert" category is the highest value among all the expert categories.

2. A majority of students have "little" to "none" expertise in producing reproducible research and Matlab. Hypothetically the instructor should focus on these areas. 

3. There is an almost equal distribution of students who are confident in Github and those who know "none" about it. 

```{r results="asis" }
# Donut with Programs
pie.program <- rCharts$new()
pie.program <- nPlot(~program, data = data, type = 'pieChart')
pie.program$chart(donut = TRUE)
pie.program$print('iframe',  include_assets=TRUE)
```
Donut chart explains one of the most important features in our dataset. Almost 50% of our students are Master in data-science, and 20% are in certificate program.


```{r echo=FALSE, results='asis'}
#Sankey Graph
data_t=as.data.frame(table(data$program,data$text.editor))
colnames(data_t) <- c("source", "target", "value")
data_t=data_t[data_t[,3]>0,]
#remove all data with 0 relations
sankeyPlot <- rCharts$new()
sankeyPlot$setTemplate(script = "./rCharts_d3_sankey-gh-pages/layouts/chart.html")
sankeyPlot$setLib('http://timelyportfolio.github.io/rCharts_d3_sankey/libraries/widgets/d3_sankey')
sankeyPlot$set(
  data = data_t,
  nodeWidth = 15,
  nodePadding = 10,
  layout = 32,
  width = 750,
  height = 500,
  units = "TWh",
  title = "Editor-Program"
)

sankeyPlot$save('sankey.html',  cdn = TRUE)
```
<iframe width="900" height="520" frameborder="0" src = 'sankey.html' ></iframe>
The sankey chart is a good way to present a relationship between two o more variables, in this particular case  *program* and *text Editor*. it shows a preference by RStudio that is explained by the huge number of statistic and data-science master. However few students of statistics prefer different editors compare with Data-science where 40% of the students do not use RStudio.
``````{r results="asis" }
col.names.data=c("exp.R.advanced","exp.Github","exp.R.reproducible"
                 ,"exp.R.manipulation","exp.R.graphics","exp.Matlab")
matrix={}
for (name.col in col.names.data){
  row=cbind(name.col,cbind(as.character(data[,"program"]),as.character(data[,name.col])))
  matrix=rbind(matrix,row)
}
data.splot.tool=as.data.frame(matrix)
colnames(data.splot.tool)=c("tool","program","use")
data.splot.f=data.splot.tool[data.splot.tool$use != "None",]
data.final=as.data.frame(table(data.splot.f$program,data.splot.f$tool))
data.s=as.data.frame(table(data.splot.tool$tool,data.splot.tool$use))
colnames(data.s) <- c("source", "target", "value")
colnames(data.final) <- c("source", "target", "value")
data_sfinal=rbind(data.s,data.final)

#remove all data with 0 relations
sankeyPlotTool <- rCharts$new()
sankeyPlotTool$setTemplate(script = "./rCharts_d3_sankey-gh-pages/layouts/chart.html")
sankeyPlotTool$setLib('http://timelyportfolio.github.io/rCharts_d3_sankey/libraries/widgets/d3_sankey')
sankeyPlotTool$set(
  data = data_sfinal,
  nodeWidth = 15,
  nodePadding = 10,
  layout = 35,
  width = 750,
  height = 500,
  units = "TWh",
  title = "Editor-Program"
)

sankeyPlotTool$save('sankey_tool.html',  standalone = TRUE)


```
<iframe width="900" height="520" frameborder="0" src = 'sankey_tool.html' ></iframe>
This Chart shows a relation between *program* , *tool* and *experience level*. We removed the association between program and tool when the level of experience is None. In Master Data-Science (IDSE) Github and Matlab are the most unknown topic and in certification program have a poor experience with R.reproducible. However 30% of all students do not have any knowledge in Matlab and 91% of them have worked with R.Manipulation.
Analysis on Tools:


# Tools

- R, Python, and Excel are the most commonly used tools among students.
```{r echo=FALSE}

# Total numer of use with all tools.
barplot(sort(colSums(data[, 11:30]) / nrow(data), decreasing = TRUE), las = 3, cex.names = 0.9, ylab = "Percent of students", main = "Experience with all tools")
```

Hierarchical clustering reveals distinct clusters of tool usage.

We interpret these clusters as:
- Excel users
- Engineering tools
- Miscellaneous languages
- R and R packages
```{r echo=FALSE}
corr.matrix <- cor(data[, 11:30])
distance <- dist(corr.matrix)
plot(hclust(distance), 
     main="Hierarchical clustering of tools", xlab="Tool")
```
The correlation plot below reveals the finer relationships between these clusters.
Some notable relationships:
- Negative relationship between R and Python: Students tend to use one or the other.
- 

```{r echo=FALSE}
ordering <- hclust(distance)$labels[hclust(distance)$order]
color.map <- colorRamp(c("#CC0000","white","#3366CC"), space="Lab")
plotcorr(corr.matrix[ordering,ordering], 
         col=rgb(color.map((corr.matrix[ordering,ordering]+1)/2), maxColorValue=255),
         mar = c(0.1, 0.1, 0.1, 0.1), type='lower')
text(5.5, 19, labels = 'Excel users', col = rgb(0,0,0,.8))
text(10, 15, labels = 'Engineering', col = rgb(0,0,0,.8))
text(14, 9, labels = 'Misc.', col = rgb(0,0,0,.8))
text(18, 5, labels = 'R users', col = rgb(0,0,0,.8))
```




Next, we want to focus on those tools which are popular in this class. Because many tools are voted only once, we only select the top 7 text editor tools.

```{r echo=FALSE}
# find out top 7 code editor tools used most.
by_preferred_tool <- table(data$text.editor)
by_preferred_tool <- sort(by_preferred_tool, decreasing = TRUE)[1:7]
barplot(by_preferred_tool, las = 3, cex.names = 0.74, ylab = "Total number", main = "top 7 code editor tools used most")
```

We can see that RStudio is the most popular one, with huge preference among all other tools.

The following graphs are single demonstration and analysis on each tools.

The number of studetns using Rstudio are lot more than any other text editor tools. Other common choices, reletively, are notepad+, sublime text and vim.






```{r echo=FALSE}
qplot(data$exp.R.graphics, data = data)
```

More than half of the students have none or limited expereince with the R graphics. But there is still few expert in R graphics.

```{r echo=FALSE}
qplot(data$exp.R.advanced) 
```

Similar to the R graphics skills, more than half of the students have limited experience in advanced packages in R as well.

```{r echo=FALSE}
qplot(data$exp.R.manipulation) 
```

Contrary to the previous two categories, more students have confidence and experience with data manipulation in R.

```{r echo=FALSE}
qplot(data$exp.R.reproducible)
```

It seems like that students' experience in this part of R are almost evenly distributed, except for the expert level. 

```{r echo=FALSE}
qplot(data$exp.Matlab)
```

Majority of the students don't have or have limited experience in Matlab, just like in R graphics.

```{r echo=FALSE}
qplot(data$exp.Github) 

```

Very similar to what happens in the last graph, most of the students do not or have limited experience in Github.
``````{r results="asis" }



col.names.data=c("exp.R.advanced","exp.Github","exp.R.reproducible"
                 ,"exp.R.manipulation","exp.R.graphics","exp.Matlab")
matrix={}
for (name.col in col.names.data){
  row=cbind(name.col,as.character(data[,name.col]))
  matrix=rbind(matrix,row)
}
data.boxplot=as.data.frame(matrix)
colnames(data.boxplot)=c("tool","experience")

n2<-rCharts$new()
n2 = nPlot( ~experience,group="tool", data = data.boxplot, type = "multiBarChart")
n2$print('inline',  include_assets=TRUE)

```
The Multibarplot is used to summarize the experience  with out taking account the program. R manipulation and graphics are topics that the students are confident. The number of confident students in any tool is similar to the number of students with a lack experience. Little is the most likely answer



```{r echo=FALSE} 

exp_tool <- apply(data[ , c(3, 6:10)], 2, FUN = table)
colnames(exp_tool) <- c("r_manipulation", "r_graphics", "r_advanced", "r_reproducible", "Matlab", "Github")
spine(t(exp_tool), main = "Programming and Analytical Experiences with All Tools")

```

Generally, for each skill, there are few people who are experts of that certain skill. Most people (more than 2/3) know nothing and a little about R advanced, R reproducible, Matlab and Github, while more people are confident about R manipulation and R graphics. In general, it's a good mix of all kinds of skill sets.


